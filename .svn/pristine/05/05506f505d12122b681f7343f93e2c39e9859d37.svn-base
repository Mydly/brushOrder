import { Nav, Login, CacheName, API } from '../config/consts';
//import fetch from 'isomorphic-fetch';
import { req } from '../main/requests';
import { mem, alog } from '../function/common';

export const tabChangeAction = i => ({
  type: Nav.changeTab,
  item: i,
});

export const changeTab = (i) =>{
    return (dispatch) => {
      dispatch( tabChangeAction(i) );
    };
}

//export const loginAction = (username,password) => {
//    return (dispatch) => {
//        dispatch({type:Login.logining});
//        return fetch('http://ming.a.com/app/art/login')
//                .then(response => response.json())
//                .then(json => {
//                    dispatch ({type:Login.logined,res:json})
//                })
//    }
//}

export const loginAction = (username, password) => {
    return (dispatch) => {
        dispatch({type:Login.logining});
        return req('app/login/submit','post',{
            "username":username,
            "password":password
        },(data)=>{
            if( data.status == 1 ){
                mem(CacheName.userid,data.info.ID);
                mem(CacheName.userToken,data.info.TOKEN);
                dispatch({type:Login.loginSuc,res:data.info});

                alog('get user info');
                dispatch({type:API.startGetUserInfo});
                req("app/user/userinfo","get",{},(data2)=>{
                    if(data2.status == 1){
                        return dispatch({type:API.successGetUserInfo,res:data2.info})
                    }
                    else{

                        return dispatch({type:API.failGetUserInfo,res:data2.info});
                    }
                },true);
            }
            else {
               return dispatch({type:Login.loginFail,res:data.info});
            }
        });
    }
}

export const getUserInfo = () => {
    alog('get user info start');
    return (dispatch) => {
        alog('get user info');
        dispatch({type:API.startGetUserInfo});
        req("app/user/userinfo","get",{},(data2)=>{
            if(data2.status == 1){
                return dispatch({type:API.successGetUserInfo,res:data2.info})
            }
            else{

                return dispatch({type:API.failGetUserInfo,res:data2.info});
            }
        },true);
    };
}