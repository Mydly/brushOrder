import React, { Component } from 'react';
import { connect } from 'react-redux';

import { Table, Icon, Button  } from 'antd';
const ButtonGroup = Button.Group;
import Action, { getMyfinan,changeTab, tabChangeAction } from '../../actions/topNav';
import Consts from '../../config/consts';

class MyFinan extends React.Component {

    constructor(props) {
        super(props);
        this.handleCoinIn = this.handleCoinIn.bind(this);
        this.handleCoinOut = this.handleCoinOut.bind(this);
    }

    componentDidMount(){
        let getUserFinan = this.props.getMyFinan;
        getUserFinan();
    }

    //组件将更新
    componentWillUpdate(){

    }

    handleCoinIn(e){
        e.preventDefault();
        console.log('转入');

        this.props.change(Consts.pageKey.finanIn.key);

    }

    handleCoinOut(e){
        e.preventDefault();
        this.props.change(Consts.pageKey.finanOut.key);
    }

    render() {

        const width = 120;
        const columns = [
            {
            title: '币种',
            dataIndex: 'coinname',
            key: 'coinname',
            width:width,
            render: text => <a href="#">{text}</a>,
        }, {
            title: '可用',
            dataIndex: 'canuse',
            key: 'canuse',
            width:width,
        }, {
            title: '冻结',
            dataIndex: 'dongjie',
            key: 'dongjie',
            width:width,
        }, {
            title: '合计',
            dataIndex: 'total',
            key: 'total',
            width:width,
        }, {
            title: '折合',
            dataIndex: 'zhehe',
            key: 'zhehe',
            width:width,
        }, {
            title: '操作',
            dataIndex: 'option',
            key: 'option',
            width:width,
            render:(text)=>(
                <div>
                    <ButtonGroup>
                        <Button type="primary"
                                onClick={this.handleCoinIn}>转入</Button>
                        <Button type="primary"
                                onClick={this.handleCoinOut}>转出</Button>
                    </ButtonGroup>
                </div>
            )
        }];

        console.log(this.props.topNav);

        const data = [];
        if(this.props.myFinan){
            console.log('我的资产 渲染开始');
            let index = 0;
            let finan = this.props.myFinanRes.finan;
            for(var key in finan){
                var value = finan[key];
                let row = {
                    key:index,
                    coinname:key,
                    canuse:value['keyong'],
                    dongjie:value['dongjie'],
                    total:value['zongji']
                };
                data.push(row);
                index++;
            }
        }

        return (
            <Table columns={columns} dataSource={data} />
        );
    }
}

const mapStateToProps = (state) => {

    return {
        state:state,
        myFinan:state.topNav.myFinan,
        myFinanRes:state.topNav.myFinanRes
    };
}

const mapDispatchToProps = (dispatch) => {
    return {
        getMyFinan:() => {
            dispatch(getMyfinan())
        },
        art:(msg)=>{
            dispatch(Action.art(msg))
        },
        changeTab:(key) => {
            dispatch(tabChangeAction(key))
        }
    }


}

export default connect(mapStateToProps,mapDispatchToProps)(MyFinan);