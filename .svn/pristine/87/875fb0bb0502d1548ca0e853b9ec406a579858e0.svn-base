import http from  'http';
import querystring from 'querystring';
import { HttpHost as api_host, } from '../config/config';
import { CacheName, } from '../config/consts';
import $ from 'jquery';
import { mem, alog, isFunction, isString } from '../function/common';

export const req = (url,method,datas,callBack,withHeader) => {

    url = api_host + '/' + url;
    url += '/platform/pc';
    alog('method:' + method + '\n ' + 'url:' + url + '\npostdata:' + (isString(datas)? datas : JSON.stringify(datas)));

    var headers = withHeader ? { 'ID':mem(CacheName.userid), 'TOKEN':mem(CacheName.userToken), 'AUTHOR':'movesay.com'} : {} ;

    $.ajax({
        type: method,
        url: url,
        data: datas,
        dataType: 'json',
        timeout: 30000,
        headers:headers,
        success: function (data) {
            alog(data);
            !isFunction(callBack) || callBack(data);
        },
        error: function (xhr, type) {
            alog('网络错误,错误类型:'+type);
        }
    });

}

//export const req = (url,method,datas,callBack) => {
//    //url = config.config().api_host + url + '?ajax=1&t=' + Math.random();
//
//    url += '/platform/pc';
//    var postData = querystring.stringify(datas || {});
//    !(method.toLowerCase() == 'get' ) || (url += '?' + postData);
//    alog('method:' + method + '  ' + 'url:' + url + 'postdata:' + postData);
//    var options = {
//        host: api_host,
//        port: 80,
//        path: url,
//        method: method,
//        headers: {
//            //"Content-Type": "text/plain"
//            'Content-Type': 'application/x-www-form-urlencoded',// 不写这个参数，后台会接收不到数据
//        }
//    };
//    console.log('====');
//    //return;
//    var req = http.request(options, function (res) {
//        var size   = 0;
//        var chunks = [];
//        res.on('data', function (chunk) {
//            size += chunk.length;
//            chunks.push(chunk);
//            alog('size='+size);
//        });
//        res.on('end', function () {
//            var data = Buffer.concat(chunks, size);
//            alog(chunks);
//           !callBack || callBack(data);
//           //return data;
//        });
//    });
//    req.write(method.toLowerCase() == 'get' ? '' : (postData || ''));
//    req.end();
//}

//export const reqWithHeader = (url,method,datas,callBack) => {
//    if(!chkLogin()){
//        return;
//    }
//    //url = config.config().api_host + url + '?ajax=1&t=' + Math.random();
//
//    url += '/platform/pc';
//    var postData = querystring.stringify(datas || {});
//    !(method.toLowerCase() == 'get' ) || (url += '?' + postData);
//    alog('method:'+method+'  '+'url:'+url+'postdata:'+postData);
//    var options = {
//        host:api_host,
//        port:80,
//        path:url,
//        method:method,
//        headers:{
//            //"Content-Type": "text/plain"
//            'Content-Type' : 'application/x-www-form-urlencoded',// 不写这个参数，后台会接收不到数据
//            'ID':mem('ID'),
//            'TOKEN':mem('TOKEN'),
//        }
//    };
//    console.log(postData);
//    //return;
//    var req = http.request(options,function (res){
//        var size = 0;
//        var chunks = [];
//        res.on('data', function(chunk){
//            size += chunk.length;
//            chunks.push(chunk);
//        });
//        res.on('end', function(){
//            var data = Buffer.concat(chunks,size).toString('utf-8');
//           !callBack || callBack(data);
//            return data;
//        });
//    });
//    req.write( method.toLowerCase() == 'get' ? '' : (postData || '') );
//    req.end();
//}


