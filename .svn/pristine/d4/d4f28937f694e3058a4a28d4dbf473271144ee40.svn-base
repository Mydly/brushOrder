/**
 * Created by Administrator on 2017/4/13.
 */
import React from 'react';
import ReactDOM from 'react-dom';
import CommentForm from './CommentForm';
import CommentList from './CommentList';
import navCss from '../../static/style/main.scss';


//class CommentBox extends React.Component {
//
//    getInitialState(){
//        return {data: []};
//    }
//
//    componentDidMount(){
//        $.ajax({
//            url: this.props.url,
//            dataType: 'json',
//            cache: false,
//            success: function(data) {
//                this.setState({data: data});
//            }.bind(this),
//            error: function(xhr, status, err) {
//                console.error(this.props.url, status, err.toString());
//            }.bind(this)
//        });
//    }
//
//    render(){
//
//        console.log(this.props.url);
//
//        return (
//          <div className="commentBox">
//              评论框
//              <CommentList data={this.state.data}/>
//              <CommentForm/>
//          </div>
//        );
//    }
//}

var CommentBox = React.createClass({


    getInitialState() {
        return {data: []};
    },

    loadCommentFromServer(){
        console.log('req');
        var xhr = new XMLHttpRequest();
        xhr.open("get",this.props.url,true);
        xhr.send();
        xhr.onreadystatechange = function() {
            if(xhr.readyState == 4 && xhr.status == 200) {
                var jsondata = JSON.parse(xhr.responseText);
                this.setState({data:jsondata.info})
            }
        }.bind(this)
    },

    componentDidMount(){


        this.loadCommentFromServer();
        //setInterval(this.loadCommentFromServer, this.props.pollInterval);
    },

    render(){

        console.log(this.props.url);

        console.log(this.state.data);

        return (
            <div className="nav">
                评论框
                <CommentList data={this.state.data} />
                <CommentForm postUrl={this.props.postUrl}/>
            </div>
        );
    }
});

module.exports = CommentBox;