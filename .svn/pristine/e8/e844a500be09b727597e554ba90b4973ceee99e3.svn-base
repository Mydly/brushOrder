import React, { PropTypes } from 'react'
import '../../static/style/common.scss'
import { loginAction } from '../../actions/topNav'
import { connect } from 'react-redux';

import { isMobile, isPassword, alog } from '../../function/common'
import { AlertType } from '../../config/consts'
import { art } from '../../actions/topNav'



import { Form, Input, Tooltip, Icon, Cascader, Select, Row, Col, Checkbox, Button } from 'antd';
const FormItem = Form.Item;
const Option = Select.Option;


class Login extends React.Component {

    constructor(props) {
        super(props);
        this.handleSubmit = this.handleSubmit.bind(this);

    }

    handleSubmit(e) {
        e.preventDefault();

        this.props.form.setFields({
            mobile: {
                value: "15623247776"
            },
            psd: {
                value: "admin123"
            },
        });

       let mobile = this.props.form.getFieldValue('mobile');
       let psd = this.props.form.getFieldValue('psd');
        alog('click login');

        if( !isMobile(mobile) ){ alog('手机号不合法'); return; }
        if( !isPassword(psd) ){ alog('登录密码不合法'); return; }

        const { loginClick,art } = this.props;
        loginClick(mobile,psd);
        //art('登录中...',AlertType.infoAlert,3000);
    }

    pri() {

        console.log('start pri ');
        console.log(arguments);
        var ind = 0;
        while (arguments[ind] != undefined){
            console.log(ind+"\n");
            console.log(arguments[ind]);
            ind++;
        }
    }

    componentWillUpdate(){

    }

    render() {
        const { getFieldDecorator } = this.props.form;
        console.log(this.props);
        const formItemLayout = {
            labelCol: {
                xs: { span: 24 },
                sm: { span: 6 },
            },
            wrapperCol: {
                xs: { span: 24 },
                sm: { span: 14 },
            },
        };
        const tailFormItemLayout = {
            wrapperCol: {
                xs: {
                    span: 24,
                    offset: 0,
                },
                sm: {
                    span: 14,
                    offset: 6,
                },
            },
        };

        return (
            <Form className='loginContainar'>
                <FormItem
                    {...formItemLayout}
                    label="手机号"
                    hasFeedback
                >
                    {getFieldDecorator('mobile', {
                        rules: [{
                            pattern: /^\d{11}$/, message: '请输入11位手机号'
                        }, {
                            required: true, message: '请输入11位手机号',
                        }],
                    })(
                        <Input />
                    )}
                </FormItem>
                <FormItem
                    {...formItemLayout}
                    label="密码"
                    hasFeedback
                >
                    {getFieldDecorator('psd', {
                        rules: [{
                            pattern: /^\S{5,20}$/, message: '请输入5位以上的密码'
                        }, {
                            required: true, message: '请输入5位以上的密码',
                        }],
                    })(
                        <Input type="password"/>
                    )}
                </FormItem>
                <FormItem {...tailFormItemLayout}>
                    <Button type="primary" size="large" onClick={this.handleSubmit}>登录</Button>
                </FormItem>
            </Form>
        );
    }

}

Login.propTypes = {
    loginClick: PropTypes.func,
}

const mapDispatchToProps = (dispatch) => {
    return {
        loginClick:(username,password) => {
            dispatch( loginAction(username,password) )
        },
        art:(msg,type,time)=>{
            dispatch( art(msg,type,time))
        }
    }
}

const LoginCon = Form.create()(Login);

export default connect(null,mapDispatchToProps)(LoginCon);